# Codebase Structure

**Analysis Date:** 2026-02-16

## Directory Layout

```
/workspace/gitprojects/adventure-alerts/
├── apps/
│   └── dashboard/                      # Next.js 16 frontend application
│       ├── src/
│       │   ├── app/                    # Next.js App Router pages
│       │   │   ├── page.tsx            # Home (Mission Control)
│       │   │   ├── trips/              # Trip management page
│       │   │   ├── booking-browser/    # Event search/browse page
│       │   │   ├── settings/           # User settings page
│       │   │   ├── layout.tsx          # Root layout with fonts/metadata
│       │   │   ├── providers.tsx       # Mantine + theme setup
│       │   │   └── globals.css         # Global Tailwind styles
│       │   ├── components/             # Reusable React components
│       │   │   ├── master-clock.tsx    # Hero UTC clock display
│       │   │   ├── upcoming-bookings.tsx # Booking cards grid
│       │   │   ├── alert-form.tsx      # Alert creation form
│       │   │   ├── trip-form.tsx       # Trip creation form
│       │   │   ├── sidebar.tsx         # Navigation sidebar
│       │   │   ├── header.tsx          # Top header bar
│       │   │   ├── system-status.tsx   # API sync status panel
│       │   │   ├── alerts-table.tsx    # Legacy alerts list
│       │   │   └── utc-clock.tsx       # Reusable clock widget
│       │   ├── lib/
│       │   │   └── theme.ts            # Mantine theme + color definitions
│       │   ├── assets/                 # Custom fonts
│       │   │   ├── goudy-old-style.ttf
│       │   │   ├── cabin-variable.ttf
│       │   │   └── inconsolata-variable.ttf
│       │   └── public/                 # Static files
│       ├── package.json                # Dashboard dependencies
│       ├── tsconfig.json
│       └── next.config.js
├── packages/
│   ├── api/                            # Cloudflare Workers API
│   │   ├── src/
│   │   │   ├── index.ts                # HTTP routes + Hono app
│   │   │   └── alert-manager.ts        # Durable Object for scheduling
│   │   ├── wrangler.jsonc              # Cloudflare Workers config
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   └── README.md
│   ├── db/                             # Drizzle ORM + D1 schemas
│   │   ├── src/
│   │   │   ├── schema.ts               # 8 table definitions
│   │   │   └── index.ts                # Factory function
│   │   ├── migrations/                 # Auto-generated by drizzle-kit
│   │   ├── drizzle.config.ts
│   │   ├── package.json
│   │   ├── tsconfig.json
│   │   └── README.md
│   └── types/                          # Shared TypeScript types & validators
│       ├── src/
│       │   └── index.ts                # All types, constants, validators
│       ├── package.json
│       └── tsconfig.json
├── package.json                        # Monorepo workspace root
├── tsconfig.json                       # Base TypeScript config
├── CLAUDE.md                           # Claude Code guidance
├── DECISIONS.md                        # Implementation patterns & conventions
└── README.md                           # Product vision & setup
```

## Directory Purposes

**`/apps/dashboard`:**
- Purpose: Next.js 16 frontend for "Mission Control" UI
- Contains: React components, pages, theme configuration, fonts
- Key files: `app/page.tsx` (main dashboard), `components/*` (UI building blocks)

**`/apps/dashboard/src/app`:**
- Purpose: Next.js App Router page structure
- Contains: Route pages (page.tsx files) and shared layout
- Structure: One directory per route (`/trips`, `/booking-browser`, `/settings`)

**`/apps/dashboard/src/components`:**
- Purpose: Reusable React components for UI assembly
- Contains: Master clock, countdown cards, forms, headers, sidebars
- Pattern: Mantine UI as base, Tailwind CSS for custom styling

**`/packages/api`:**
- Purpose: Cloudflare Workers HTTP API with Durable Object support
- Contains: Hono.js routes, request validation, database access
- Config: `wrangler.jsonc` for Workers + D1 + Durable Object bindings

**`/packages/db`:**
- Purpose: Database schema definitions and Drizzle ORM configuration
- Contains: SQLite table definitions, type inference exports
- Auto-generated: `migrations/` directory created by `drizzle-kit generate`

**`/packages/types`:**
- Purpose: Shared TypeScript interfaces and business logic validators
- Contains: All API request/response types, tier constants, validation functions
- No external dependencies: This is the leaf module

## Key File Locations

**Entry Points:**

- `apps/dashboard/src/app/page.tsx`: Dashboard home page (Mission Control) - initializes server time sync and alert polling
- `packages/api/src/index.ts`: API routes (11 endpoints across alerts/trips/time)
- `packages/api/src/alert-manager.ts`: Durable Object class for precision scheduling

**Configuration:**

- `packages/api/wrangler.jsonc`: Cloudflare Workers config with D1 + Durable Object bindings
- `apps/dashboard/src/lib/theme.ts`: Mantine theme + custom color palette (seaBlue, compassGold, parchment, ink)
- `tsconfig.json`: Base TypeScript config (root workspace)

**Core Logic:**

- `packages/types/src/index.ts`: 370 lines - types, TIER_LIMITS, getDashboardState(), validateTripDuration()
- `packages/db/src/schema.ts`: 226 lines - 8 Drizzle tables (users, trips, activities, events, booking_rules, blueprints)
- `packages/api/src/index.ts`: 412 lines - 11 HTTP endpoints with Drizzle + raw SQL queries

**Testing:**

- No test files present in codebase (testing structure not yet established)

## Naming Conventions

**Files:**

- Page components: `page.tsx` (Next.js App Router convention)
- UI components: `kebab-case.tsx` (e.g., `master-clock.tsx`, `upcoming-bookings.tsx`)
- Utilities/libraries: `kebab-case.ts` (e.g., `theme.ts`)
- Schemas: `schema.ts` (singular, exports all tables)
- Config: lowercase descriptive names (`wrangler.jsonc`, `drizzle.config.ts`, `tsconfig.json`)

**Directories:**

- Feature pages: `/apps/dashboard/src/app/{featureName}/` (e.g., `/trips/`, `/booking-browser/`)
- Reusable components: `/apps/dashboard/src/components/`
- Type definitions: `/packages/{domain}/src/` where domain is `types`, `db`, `api`
- Configuration: Root of each package (wrangler.jsonc, tsconfig.json)

**TypeScript:**

- Interface names: PascalCase + suffix (e.g., `Alert`, `CreateAlertRequest`, `ListTripsResponse`)
- Type aliases: PascalCase (e.g., `AlertStatus`, `DashboardState`, `UserTier`)
- Constants: UPPER_SNAKE_CASE (e.g., `TIER_LIMITS`, `DEFAULT_APPROACHING_THRESHOLD`)
- Functions: camelCase (e.g., `validateTripDuration()`, `getDashboardState()`, `getConfidenceLevel()`)
- Variables: camelCase (e.g., `serverTimeOffset`, `connectionStatus`, `alertId`)

## Where to Add New Code

**New Feature (e.g., notifications system):**

1. **Types**: Add interfaces to `packages/types/src/index.ts` for request/response contracts
2. **Database**: Add table(s) to `packages/db/src/schema.ts`, run `drizzle-kit generate`
3. **API**: Add routes to `packages/api/src/index.ts` (or new file if large feature)
4. **Frontend**: Add page at `apps/dashboard/src/app/{featureName}/page.tsx`, components in `src/components/`

**New Component:**

- Location: `apps/dashboard/src/components/{feature-name}.tsx`
- Pattern: Export named function, accept typed props, use Mantine + Tailwind CSS
- Example: `master-clock.tsx` (clock display with server sync)

**New Validation Function:**

- Location: `packages/types/src/index.ts`
- Pattern: Pure function returning validation result or error message
- Example: `validateTripDuration()`, `getDashboardState()`

**New Utility:**

- Small (<50 lines): Inline in component file or `app/page.tsx`
- Medium (50-150 lines): Create `apps/dashboard/src/lib/{utility-name}.ts`
- Large or shared: If used by API too, add to `packages/types/src/index.ts`

**Database Migration:**

- Add/modify table in `packages/db/src/schema.ts`
- Run: `npm run generate --workspace=packages/db` to create migration file
- Migration files auto-created in `packages/db/migrations/` (do not edit manually)

## Special Directories

**`/apps/dashboard/src/assets`:**
- Purpose: Custom fonts embedded in Next.js
- Generated: No (committed to repo)
- Contents: `goudy-old-style.ttf`, `cabin-variable.ttf`, `inconsolata-variable.ttf`
- Usage: Imported in `app/layout.tsx` via `next/font/local`

**`/packages/db/migrations`:**
- Purpose: Auto-generated SQL migration files
- Generated: Yes (by `drizzle-kit generate`)
- Committed: Yes (part of version control for schema tracking)
- Manual editing: Never - regenerate via drizzle-kit if schema changes

**`/packages/api/.wrangler`:**
- Purpose: Cloudflare Workers local development state
- Generated: Yes (by `wrangler dev`)
- Committed: No (.gitignored)
- Contents: Local D1 database, cache files

**`/apps/dashboard/.next`:**
- Purpose: Next.js build output and cache
- Generated: Yes (by `next build` or `next dev`)
- Committed: No (.gitignored)
- Contents: Compiled JavaScript, static assets

## Cross-Package Dependencies

**Dependency Graph:**

```
packages/types/                (0 dependencies - leaf)
    ↑
packages/db/                   (imports from types)
    ↑
packages/api/                  (imports from db + types)

apps/dashboard/                (imports types only, accesses api via HTTP)
    ↑
Dashboard HTTP endpoints       (no cross-package imports)
```

**Rules:**

- ✓ API can import from DB and types
- ✓ DB can import from types
- ✓ Dashboard can import from types only
- ✓ Dashboard accesses API via HTTP endpoints
- ✗ Never import from apps/ into packages/
- ✗ Never import DB code into Dashboard (use HTTP API instead)

## Module Exports

**`packages/types/src/index.ts`:**
- Exports: All types (User, Trip, Activity, Event, Alert, etc.)
- Exports: Constants (TIER_LIMITS, DEFAULT_APPROACHING_THRESHOLD)
- Exports: Validators (validateTripDuration, getDashboardState, getNotificationStage)
- Usage: API validation, Dashboard type checking

**`packages/db/src/index.ts`:**
- Exports: All schema tables via wildcard (`export * from './schema'`)
- Exports: `createDb()` factory function
- Exports: Database type inference (`Database` type)
- Usage: API route handlers pass D1 binding to createDb()

**`packages/api/src/index.ts`:**
- Exports: Default Hono app (used by Cloudflare Workers)
- Exports: AlertManager class (re-exported from alert-manager.ts)
- HTTP routes: 11 endpoints (alerts, trips, time, status)

**`apps/dashboard/src/app/page.tsx`:**
- Exports: Default HomePage component
- Imports: Internal components (sidebar, header, clock, bookings grid)
- No re-exports

## Asset Organization

**Fonts (`/apps/dashboard/src/assets`):**
- `goudy-old-style.ttf`: Display font (headlines, branding)
- `cabin-variable.ttf`: Body font (regular + italic)
- `inconsolata-variable.ttf`: Monospace (code, technical text)

**Colors (in `lib/theme.ts`):**
- seaBlue: `#1e8cba` (primary, accent for "normal" state)
- compassGold: `#d4a418` (warning, "approaching" state)
- parchment: `#faf6f0` (background, light theme)
- ink: `#2d251f` (text, dark theme)
- Red variants for errors/urgent states

**CSS:**
- Tailwind CSS for utility styles (padding, margins, responsive)
- Mantine CSS for component themes (buttons, forms, layout)
- Global CSS in `app/globals.css` for reset + custom properties
