---
phase: 03-runtime-generation
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - .devcontainer/install-agent-config.sh
  - .devcontainer/refresh-firewall-dns.sh
  - .devcontainer/Dockerfile
  - .devcontainer/save-secrets.sh
  - .gitignore
  - .vscode/settings.json
  - infra/scripts/generate-env.sh
autonomous: true

must_haves:
  truths:
    - "firewall-domains.conf is generated by install-agent-config.sh from config.json with core domains + extra_domains"
    - "api.openai.com and generativelanguage.googleapis.com are in the generated firewall-domains.conf"
    - "refresh-firewall-dns.sh reads ALL domains from firewall-domains.conf (no hardcoded DOMAINS array)"
    - ".vscode/settings.json is generated by install-agent-config.sh with git.scanRepositories from config.json"
    - ".vscode/settings.json is in .gitignore"
    - "save-secrets.sh captures live credentials back to secrets.json"
    - "Dockerfile sources ~/.claude-api-env for API key exports"
    - "install-agent-config.sh generates ~/.claude-api-env with OPENAI_API_KEY and GOOGLE_API_KEY"
    - "generate-env.sh writes Langfuse project keys back to secrets.json (CRD-04)"
  artifacts:
    - path: ".devcontainer/install-agent-config.sh"
      provides: "Complete config generation pipeline"
      contains: "firewall-domains.conf"
    - path: ".devcontainer/refresh-firewall-dns.sh"
      provides: "Simplified firewall refresh reading from generated conf"
      contains: "firewall-domains.conf"
    - path: ".devcontainer/save-secrets.sh"
      provides: "Credential capture helper"
      contains: "secrets.json"
    - path: ".devcontainer/Dockerfile"
      provides: "Container image with API key sourcing and save-secrets"
      contains: "claude-api-env"
    - path: "infra/scripts/generate-env.sh"
      provides: "Langfuse env generator with secrets.json writeback"
      contains: "secrets.json"
  key_links:
    - from: ".devcontainer/install-agent-config.sh"
      to: ".devcontainer/firewall-domains.conf"
      via: "Generates from config.json core domains + extra_domains"
      pattern: "firewall-domains.conf"
    - from: ".devcontainer/refresh-firewall-dns.sh"
      to: ".devcontainer/firewall-domains.conf"
      via: "Reads all domains from generated conf file"
      pattern: "firewall-domains.conf"
    - from: ".devcontainer/save-secrets.sh"
      to: "secrets.json"
      via: "jq merge of live credentials into secrets.json"
      pattern: "secrets.json"
    - from: ".devcontainer/install-agent-config.sh"
      to: "~/.claude-api-env"
      via: "Writes OPENAI_API_KEY and GOOGLE_API_KEY exports"
      pattern: "claude-api-env"
---

<objective>
Implement full config generation (firewall domains, VS Code settings) and credential persistence tooling (save-secrets helper, API key exports, Langfuse key writeback).

Purpose: After this plan, ALL runtime configuration files are generated from config.json + secrets.json — firewall domains, VS Code settings, MCP configs, Claude settings, and API key exports. The save-secrets helper enables round-trip credential persistence. This completes the core refactor vision: "config.json + secrets.json in, working container out."

Output: Extended install script with firewall and VS Code generation, simplified firewall refresh script, save-secrets helper, API key environment file, generate-env.sh with secrets.json writeback.
</objective>

<execution_context>
@/home/node/.claude/get-shit-done/workflows/execute-plan.md
@/home/node/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-runtime-generation/03-RESEARCH.md
@.planning/phases/03-runtime-generation/03-01-SUMMARY.md
@.devcontainer/install-agent-config.sh
@.devcontainer/refresh-firewall-dns.sh
@.devcontainer/Dockerfile
@.devcontainer/firewall-domains.conf
@.gitignore
@.vscode/settings.json
@config.json
@secrets.example.json
@infra/scripts/generate-env.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate firewall-domains.conf from config.json (GEN-01, GEN-02)</name>
  <files>
    .devcontainer/install-agent-config.sh
    .devcontainer/refresh-firewall-dns.sh
    .devcontainer/firewall-domains.conf
  </files>
  <action>
    **Part A: Add firewall domain generation to install-agent-config.sh**

    Add a new section to install-agent-config.sh AFTER the config.json loading block and BEFORE the "Create directories" block. This generates firewall-domains.conf from a core domain list plus config.json extra_domains:

    ```bash
    # Generate firewall-domains.conf from config.json (GEN-01, GEN-02)
    FIREWALL_CONF="$WORKSPACE_ROOT/.devcontainer/firewall-domains.conf"
    CORE_DOMAINS=(
        # Package registries
        "registry.npmjs.org"
        "registry.npmjs.com"
        # Anthropic services
        "api.anthropic.com"
        "sentry.io"
        "statsig.anthropic.com"
        "statsig.com"
        # VS Code marketplace
        "marketplace.visualstudio.com"
        "gallerycdn.vsassets.io"
        "gallery.vsassets.io"
        "vsassets.io"
        "vscode.blob.core.windows.net"
        "update.code.visualstudio.com"
        # Debian repositories
        "deb.debian.org"
        "security.debian.org"
        # GitHub (IP ranges handled separately by init-firewall.sh)
        "github.com"
        "objects.githubusercontent.com"
        "uploads.github.com"
        "codeload.github.com"
        # Cloudflare
        "api.cloudflare.com"
        "dash.cloudflare.com"
        "workers.dev"
        # Python packages
        "pypi.python.org"
        "pypi.org"
        "files.pythonhosted.org"
        # Other
        "storage.googleapis.com"
        "json.schemastore.org"
        # API provider domains — always present for future agent use (GEN-02)
        "api.openai.com"
        "generativelanguage.googleapis.com"
    )

    {
        echo "# Generated by install-agent-config.sh — do not edit manually"
        echo "# Core domains (always present)"
        printf '%s\n' "${CORE_DOMAINS[@]}"
        echo ""
        echo "# Extra domains from config.json"
    } > "$FIREWALL_CONF"

    # Append extra_domains from config.json
    if [ -f "$CONFIG_FILE" ]; then
        EXTRA_LIST=$(jq -r '.firewall.extra_domains // [] | .[]' "$CONFIG_FILE" 2>/dev/null || true)
        if [ -n "$EXTRA_LIST" ]; then
            echo "$EXTRA_LIST" >> "$FIREWALL_CONF"
        fi
    fi

    DOMAIN_COUNT=$(grep -c '^[^#]' "$FIREWALL_CONF" | tr -d '[:space:]')
    echo "[install] Generated firewall-domains.conf with $DOMAIN_COUNT domain(s)"
    ```

    **Part B: Simplify refresh-firewall-dns.sh to read from generated conf**

    Replace the hardcoded DOMAINS array and the EXTRA_DOMAINS_FILE reading logic in refresh-firewall-dns.sh with a single file read:

    Replace the entire DOMAINS=(...) array block AND the EXTRA_DOMAINS_FILE block (lines 9-46) with:

    ```bash
    DOMAINS_FILE="/workspace/.devcontainer/firewall-domains.conf"
    if [ ! -f "$DOMAINS_FILE" ]; then
        echo "ERROR: $DOMAINS_FILE not found. Run install-agent-config.sh first."
        exit 1
    fi

    DOMAINS=()
    while IFS= read -r domain; do
        # Skip empty lines and comments
        if [ -z "$domain" ] || [[ "$domain" =~ ^[[:space:]]*# ]]; then
            continue
        fi
        DOMAINS+=("$domain")
    done < "$DOMAINS_FILE"
    ```

    Keep everything else in refresh-firewall-dns.sh unchanged (the resolve_domain function, the parallel resolution, the ipset add loop).

    **Part C: Delete the static firewall-domains.conf**

    The current static firewall-domains.conf has one domain (adventure-alerts-api.sam-ed4.workers.dev). This domain is already in config.json's extra_domains. The file will be regenerated by install-agent-config.sh, so delete the static content and let the install script generate it fresh.

    Actually, since the file is tracked by git and will be regenerated, just leave it — the install script will overwrite it. No git rm needed.

    Commit message: "feat(03-02): generate firewall-domains.conf from config.json (GEN-01, GEN-02)"
  </action>
  <verify>
    Verify install script has firewall generation:
    - grep "CORE_DOMAINS" .devcontainer/install-agent-config.sh (should find array definition)
    - grep "api.openai.com" .devcontainer/install-agent-config.sh (should find GEN-02 domain)
    - grep "generativelanguage.googleapis.com" .devcontainer/install-agent-config.sh (should find GEN-02 domain)

    Verify refresh script reads from conf file:
    - grep "DOMAINS_FILE" .devcontainer/refresh-firewall-dns.sh (should find file read)
    - grep -c "registry.npmjs.org" .devcontainer/refresh-firewall-dns.sh (should be 0 — no hardcoded domains)

    Verify both scripts have valid syntax:
    - bash -n .devcontainer/install-agent-config.sh
    - bash -n .devcontainer/refresh-firewall-dns.sh
  </verify>
  <done>firewall-domains.conf is generated from config.json with 27+ core domains (including api.openai.com and generativelanguage.googleapis.com per GEN-02) plus user-configured extra_domains. refresh-firewall-dns.sh reads ALL domains from the generated conf file — no more hardcoded domain array.</done>
</task>

<task type="auto">
  <name>Task 2: Generate .vscode/settings.json from config.json (GEN-03)</name>
  <files>
    .devcontainer/install-agent-config.sh
    .gitignore
    .vscode/settings.json
  </files>
  <action>
    **Part A: Add .vscode/settings.json to .gitignore**

    Add to .gitignore (after the existing ".mcp.json" entry):
    ```
    # Generated VS Code settings (created by install-agent-config.sh)
    .vscode/settings.json
    ```

    **Part B: Remove .vscode/settings.json from git tracking**

    ```bash
    git rm --cached .vscode/settings.json
    ```

    The file stays on disk but is no longer tracked by git. The install script will generate it.

    **Part C: Add VS Code settings generation to install-agent-config.sh**

    Add a new section AFTER the firewall generation block:

    ```bash
    # Generate .vscode/settings.json from config.json (GEN-03)
    VSCODE_DIR="$WORKSPACE_ROOT/.vscode"
    mkdir -p "$VSCODE_DIR"

    # Read git scan paths from config.json
    GIT_SCAN_PATHS='[".", "gitprojects/adventure-alerts"]'
    if [ -f "$CONFIG_FILE" ]; then
        CONFIGURED_PATHS=$(jq -r '.vscode.git_scan_paths // []' "$CONFIG_FILE" 2>/dev/null || echo "[]")
        # If configured paths is non-empty array, use it; otherwise auto-detect
        PATH_COUNT=$(echo "$CONFIGURED_PATHS" | jq 'length' 2>/dev/null || echo "0")
        if [ "$PATH_COUNT" -gt 0 ]; then
            # User specified paths — prepend "." (workspace root) if not present
            GIT_SCAN_PATHS=$(echo "$CONFIGURED_PATHS" | jq '. as $paths | if (. | index(".")) then $paths else ["."] + $paths end')
        else
            # Auto-detect: find .git directories under gitprojects/
            DETECTED='["."]'
            if [ -d "$WORKSPACE_ROOT/gitprojects" ]; then
                for git_dir in "$WORKSPACE_ROOT/gitprojects"/*/.git; do
                    if [ -d "$git_dir" ]; then
                        project_name=$(basename "$(dirname "$git_dir")")
                        DETECTED=$(echo "$DETECTED" | jq --arg p "gitprojects/$project_name" '. + [$p]')
                    fi
                done
            fi
            GIT_SCAN_PATHS="$DETECTED"
        fi
    fi

    jq -n --argjson paths "$GIT_SCAN_PATHS" '{"git.scanRepositories": $paths}' > "$VSCODE_DIR/settings.json"
    echo "[install] Generated .vscode/settings.json with $(echo "$GIT_SCAN_PATHS" | jq 'length') scan path(s)"
    ```

    Commit message: "feat(03-02): generate .vscode/settings.json from config.json (GEN-03)"
  </action>
  <verify>
    Verify .gitignore has .vscode/settings.json:
    - grep "vscode/settings.json" .gitignore (should match)

    Verify .vscode/settings.json is untracked:
    - git status .vscode/settings.json (should show as untracked or not listed)

    Verify install script has VS Code generation:
    - grep "git.scanRepositories" .devcontainer/install-agent-config.sh (should find generation logic)

    Verify script syntax:
    - bash -n .devcontainer/install-agent-config.sh
  </verify>
  <done>.vscode/settings.json is generated from config.json by install-agent-config.sh. Auto-detects git repositories under gitprojects/ when vscode.git_scan_paths is empty. File is gitignored since it's derived from config.json.</done>
</task>

<task type="auto">
  <name>Task 3: Create save-secrets helper and API key exports (CRD-01, CRD-03)</name>
  <files>
    .devcontainer/save-secrets.sh
    .devcontainer/install-agent-config.sh
    .devcontainer/Dockerfile
  </files>
  <action>
    **Part A: Create save-secrets.sh helper (CRD-01)**

    Create .devcontainer/save-secrets.sh:
    ```bash
    #!/bin/bash
    set -euo pipefail

    # save-secrets.sh
    # Captures live credentials back into secrets.json for backup/persistence.
    # Run this before rebuilding to preserve credentials across container rebuilds.

    SECRETS_FILE="/workspace/secrets.json"
    CLAUDE_DIR="${CLAUDE_CONFIG_DIR:-/home/node/.claude}"

    # Start with existing secrets.json or empty template
    if [ -f "$SECRETS_FILE" ]; then
        SECRETS=$(cat "$SECRETS_FILE")
    else
        SECRETS='{"claude":{"credentials":{}},"langfuse":{"public_key":"","secret_key":""},"api_keys":{"openai":"","google":""}}'
    fi

    echo "[save-secrets] Capturing live credentials..."

    # Capture Claude credentials
    if [ -f "$CLAUDE_DIR/.credentials.json" ]; then
        CREDS=$(cat "$CLAUDE_DIR/.credentials.json")
        SECRETS=$(echo "$SECRETS" | jq --argjson creds "$CREDS" '.claude.credentials = $creds')
        echo "[save-secrets] Claude credentials: captured"
    else
        echo "[save-secrets] Claude credentials: not found (manual login required after rebuild)"
    fi

    # Capture Langfuse keys from settings
    if [ -f "$CLAUDE_DIR/settings.local.json" ]; then
        LF_PK=$(jq -r '.env.LANGFUSE_PUBLIC_KEY // ""' "$CLAUDE_DIR/settings.local.json" 2>/dev/null || echo "")
        LF_SK=$(jq -r '.env.LANGFUSE_SECRET_KEY // ""' "$CLAUDE_DIR/settings.local.json" 2>/dev/null || echo "")
        if [ -n "$LF_PK" ]; then
            SECRETS=$(echo "$SECRETS" | jq --arg pk "$LF_PK" '.langfuse.public_key = $pk')
        fi
        if [ -n "$LF_SK" ]; then
            SECRETS=$(echo "$SECRETS" | jq --arg sk "$LF_SK" '.langfuse.secret_key = $sk')
        fi
        echo "[save-secrets] Langfuse keys: captured"
    fi

    # Capture API keys from environment
    if [ -n "${OPENAI_API_KEY:-}" ]; then
        SECRETS=$(echo "$SECRETS" | jq --arg key "$OPENAI_API_KEY" '.api_keys.openai = $key')
        echo "[save-secrets] OpenAI API key: captured"
    fi
    if [ -n "${GOOGLE_API_KEY:-}" ]; then
        SECRETS=$(echo "$SECRETS" | jq --arg key "$GOOGLE_API_KEY" '.api_keys.google = $key')
        echo "[save-secrets] Google API key: captured"
    fi

    # Write back to secrets.json
    echo "$SECRETS" | jq '.' > "$SECRETS_FILE"
    chmod 600 "$SECRETS_FILE"
    echo "[save-secrets] Saved to $SECRETS_FILE"
    ```

    **Part B: Add API key exports to install-agent-config.sh (CRD-03)**

    Add a new section to install-agent-config.sh AFTER the credential restoration block:

    ```bash
    # Export API keys from secrets.json to shell environment file (CRD-03)
    API_ENV_FILE="/home/node/.claude-api-env"
    OPENAI_KEY=""
    GOOGLE_KEY=""
    if [ -f "$SECRETS_FILE" ]; then
        OPENAI_KEY=$(jq -r '.api_keys.openai // ""' "$SECRETS_FILE" 2>/dev/null || echo "")
        GOOGLE_KEY=$(jq -r '.api_keys.google // ""' "$SECRETS_FILE" 2>/dev/null || echo "")
    fi
    {
        echo "# Generated by install-agent-config.sh — do not edit manually"
        echo "export OPENAI_API_KEY=\"$OPENAI_KEY\""
        echo "export GOOGLE_API_KEY=\"$GOOGLE_KEY\""
    } > "$API_ENV_FILE"
    if [ -n "$OPENAI_KEY" ] || [ -n "$GOOGLE_KEY" ]; then
        echo "[install] API keys exported to $API_ENV_FILE"
    fi
    ```

    **Part C: Update Dockerfile to source API keys and install save-secrets**

    Add to Dockerfile, AFTER the existing shell export RUN block (after line 129):

    ```dockerfile
    # Source API key environment file for interactive shells (CRD-03)
    RUN echo "source ~/.claude-api-env 2>/dev/null || true" >> /home/node/.bashrc && \
        echo "source ~/.claude-api-env 2>/dev/null || true" >> /home/node/.zshrc
    ```

    Add save-secrets installation to Dockerfile, near the mcp-setup COPY block:

    ```dockerfile
    # Install save-secrets helper
    COPY --chown=node:node save-secrets.sh /tmp/save-secrets.sh
    RUN sudo cp /tmp/save-secrets.sh /usr/local/bin/save-secrets && \
        sudo chmod +x /usr/local/bin/save-secrets && \
        rm /tmp/save-secrets.sh
    ```

    Commit message: "feat(03-02): add save-secrets helper and API key exports (CRD-01, CRD-03)"
  </action>
  <verify>
    Verify save-secrets.sh exists and has correct structure:
    - ls .devcontainer/save-secrets.sh (should exist)
    - grep "credentials.json" .devcontainer/save-secrets.sh (should find Claude credential capture)
    - grep "LANGFUSE_PUBLIC_KEY" .devcontainer/save-secrets.sh (should find Langfuse key capture)
    - grep "OPENAI_API_KEY" .devcontainer/save-secrets.sh (should find API key capture)

    Verify install script has API key export:
    - grep "claude-api-env" .devcontainer/install-agent-config.sh (should find env file generation)
    - grep "OPENAI_API_KEY" .devcontainer/install-agent-config.sh (should find key export)
    - grep "GOOGLE_API_KEY" .devcontainer/install-agent-config.sh (should find key export)

    Verify Dockerfile has sourcing and save-secrets:
    - grep "claude-api-env" .devcontainer/Dockerfile (should find source command)
    - grep "save-secrets" .devcontainer/Dockerfile (should find COPY and install)

    Verify script syntax:
    - bash -n .devcontainer/save-secrets.sh
    - bash -n .devcontainer/install-agent-config.sh
  </verify>
  <done>save-secrets helper captures Claude credentials, Langfuse keys, and API keys back into secrets.json. install-agent-config.sh generates ~/.claude-api-env with OPENAI_API_KEY and GOOGLE_API_KEY exports. Dockerfile sources the API env file and installs save-secrets to PATH.</done>
</task>

<task type="auto">
  <name>Task 4: Update generate-env.sh to write Langfuse keys to secrets.json (CRD-04)</name>
  <files>infra/scripts/generate-env.sh</files>
  <action>
    Add a secrets.json writeback section at the END of generate-env.sh, AFTER the "Credentials Summary" echo block (after line ~133), BEFORE the final "Next steps" echo block:

    ```bash
    # Write Langfuse project keys back to secrets.json (CRD-04)
    SECRETS_FILE="/workspace/secrets.json"
    if command -v jq &> /dev/null; then
        if [ -f "$SECRETS_FILE" ]; then
            UPDATED=$(jq \
                --arg pk "pk-lf-local-claude-code" \
                --arg sk "$PROJECT_SECRET_KEY" \
                '.langfuse.public_key = $pk | .langfuse.secret_key = $sk' \
                "$SECRETS_FILE")
            echo "$UPDATED" > "$SECRETS_FILE"
            echo -e "${GREEN}✓ Updated secrets.json with Langfuse project keys${NC}"
        else
            # Create minimal secrets.json with Langfuse keys
            jq -n \
                --arg pk "pk-lf-local-claude-code" \
                --arg sk "$PROJECT_SECRET_KEY" \
                '{"claude":{"credentials":{}},"langfuse":{"public_key":$pk,"secret_key":$sk},"api_keys":{"openai":"","google":""}}' \
                > "$SECRETS_FILE"
            echo -e "${GREEN}✓ Created secrets.json with Langfuse project keys${NC}"
        fi
        chmod 600 "$SECRETS_FILE"
    else
        echo -e "${YELLOW}jq not available — please manually add Langfuse keys to secrets.json${NC}"
        echo "  Public Key: pk-lf-local-claude-code"
        echo "  Secret Key: $PROJECT_SECRET_KEY"
    fi
    ```

    Note: The public key is always "pk-lf-local-claude-code" (hardcoded in the .env.example template). The secret key is the generated PROJECT_SECRET_KEY variable that already exists in the script.

    Commit message: "feat(03-02): write Langfuse keys to secrets.json from generate-env.sh (CRD-04)"
  </action>
  <verify>
    Verify generate-env.sh has secrets.json writeback:
    - grep "secrets.json" infra/scripts/generate-env.sh (should find writeback logic)
    - grep "CRD-04" infra/scripts/generate-env.sh (should find comment)
    - grep "pk-lf-local-claude-code" infra/scripts/generate-env.sh (should find public key)

    Verify script syntax:
    - bash -n infra/scripts/generate-env.sh
  </verify>
  <done>generate-env.sh writes the generated Langfuse project keys (public key + secret key) back to secrets.json after generating the .env file. This ensures secrets.json is the single source of truth for all credentials, including auto-generated Langfuse keys.</done>
</task>

</tasks>

<verification>
Phase-level checks for Plan 02 (and overall Phase 3 completion combined with Plan 01):

Requirements verification:
- CTR-01: Bind mount removed (Plan 01) — `grep "USERPROFILE" .devcontainer/devcontainer.json` returns nothing
- AGT-03: Skills copied (Plan 01) — `grep "skills" .devcontainer/install-agent-config.sh` finds cp logic
- AGT-04: Hooks copied (Plan 01) — `ls agent-config/hooks/langfuse_hook.py` + grep in install script
- AGT-05: Commands copied non-destructively (Plan 01) — `grep "cp -rn" .devcontainer/install-agent-config.sh`
- GEN-01: Firewall domains generated — `grep "CORE_DOMAINS" .devcontainer/install-agent-config.sh`
- GEN-02: API domains present — `grep "api.openai.com" .devcontainer/install-agent-config.sh`
- GEN-03: VS Code settings generated — `grep "git.scanRepositories" .devcontainer/install-agent-config.sh`
- GEN-04: MCP configs generated (Phase 1) — already verified in 01-VERIFICATION
- GEN-05: Settings hydrated (Phase 1) — already verified in 01-VERIFICATION
- GEN-06: Placeholder handling (Plan 01) — `grep "UNRESOLVED" .devcontainer/install-agent-config.sh`
- CRD-01: save-secrets helper — `ls .devcontainer/save-secrets.sh` + `grep "save-secrets" .devcontainer/Dockerfile`
- CRD-02: Credential restoration (Phase 1) — already implemented
- CRD-03: API key exports — `grep "claude-api-env" .devcontainer/install-agent-config.sh`
- CRD-04: generate-env.sh writeback — `grep "secrets.json" infra/scripts/generate-env.sh`

Integration checks:
- Full config pipeline: config.json -> install-agent-config.sh -> firewall-domains.conf, .vscode/settings.json, settings.local.json, .mcp.json, ~/.claude-api-env
- Credential round-trip: secrets.json -> install (restore) -> live container -> save-secrets -> secrets.json
- Firewall chain: install-agent-config.sh generates conf -> init-firewall.sh calls refresh -> refresh reads conf -> resolves IPs -> adds to ipset
</verification>

<success_criteria>
- firewall-domains.conf generated from config.json with core domains + extra_domains + API domains (GEN-01, GEN-02)
- refresh-firewall-dns.sh reads from generated conf file, no hardcoded domain array
- .vscode/settings.json generated and gitignored (GEN-03)
- save-secrets helper captures all credential types back to secrets.json (CRD-01)
- API keys exported to ~/.claude-api-env, sourced by shell (CRD-03)
- generate-env.sh writes Langfuse keys to secrets.json (CRD-04)
- All scripts pass syntax check (bash -n)
- All 14 Phase 3 requirements satisfied across both plans
</success_criteria>

<output>
After completion, create `.planning/phases/03-runtime-generation/03-02-SUMMARY.md`
</output>
