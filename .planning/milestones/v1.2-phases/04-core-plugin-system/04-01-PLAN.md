---
phase: 04-core-plugin-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .devcontainer/install-agent-config.sh
autonomous: true

must_haves:
  truths:
    - "Markdown files in agent-config/commands/ are copied to ~/.claude/commands/ on rebuild"
    - "Standalone command copies do not overwrite GSD commands (commands/gsd/)"
    - "Command count is reported in the install summary"
    - "Skills from agent-config/skills/ are copied to both ~/.claude/skills/ AND ~/.codex/skills/"
    - "Codex config.toml includes [features] skills = true for Codex skill discovery"
    - "Install log shows dual-destination for skills: Claude + Codex"
  artifacts:
    - path: ".devcontainer/install-agent-config.sh"
      provides: "Standalone commands copy section, cross-agent skills copy, Codex config features"
      contains: "agent-config/commands"
  key_links:
    - from: ".devcontainer/install-agent-config.sh"
      to: "~/.claude/commands/"
      via: "cp loop for agent-config/commands/*.md"
      pattern: "AGENT_CONFIG_DIR.*commands"
    - from: ".devcontainer/install-agent-config.sh"
      to: "~/.codex/skills/"
      via: "cp -r for agent-config/skills/* to Codex"
      pattern: "codex.*skills"
---

<objective>
Add standalone command copying and cross-agent skill installation to install-agent-config.sh.

Purpose: Before adding the plugin system, the install script needs two foundational capabilities: (1) copying standalone slash commands from `agent-config/commands/` to `~/.claude/commands/`, and (2) copying skills to both Claude and Codex directories with the Codex skills feature flag enabled.

Output: Updated `install-agent-config.sh` with standalone commands section and cross-agent skills support.
</objective>

<execution_context>
@/home/node/.claude/get-shit-done/workflows/execute-plan.md
@/home/node/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-core-plugin-system/04-CONTEXT.md
@.planning/phases/04-core-plugin-system/04-RESEARCH.md
@.devcontainer/install-agent-config.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add standalone commands copy and cross-agent skills to install script</name>
  <files>.devcontainer/install-agent-config.sh</files>
  <action>
Modify `install-agent-config.sh` to add two new sections. All changes go into the existing script — do not create new files.

**1. Cross-agent skill installation (modify existing skills copy section, ~line 222-227):**

Replace the existing standalone skills copy block with a version that:
- Copies skills to BOTH `~/.claude/skills/` and `~/.codex/skills/` (create `~/.codex/skills/` with `mkdir -p`)
- Updates the log line to reflect dual destination: `"[install] Skills: N skill(s) -> Claude + Codex"`
- Preserves the existing `cp -r` pattern with `2>/dev/null || true` for empty directory safety

**2. Codex config.toml update (modify existing Codex config generation, ~line 209-218):**

Add a `[features]` section to the generated Codex `config.toml` with `skills = true`:
```
[features]
skills = true
```
Insert it between the global settings and the `[projects."/workspace"]` section.

**3. Standalone commands copy (NEW section, insert AFTER hooks copy ~line 235, BEFORE settings template hydration ~line 238):**

Add a new section that:
- Initializes `COMMANDS_COUNT=0` counter
- Checks if `$AGENT_CONFIG_DIR/commands` directory exists
- Iterates over `*.md` files in that directory
- Guards with `[ -f "$cmd_file" ] || continue` for empty directory safety
- Copies each `.md` file to `$CLAUDE_DIR/commands/`
- Does NOT overwrite files in `$CLAUDE_DIR/commands/gsd/` (GSD protection) — but standalone commands are flat files not directories, so the main protection is that we copy individual `.md` files, not directories. If a standalone command happens to be named `gsd` (unlikely), skip it with warning.
- Increments counter per file copied
- Logs: `"[install] Commands: $COMMANDS_COUNT standalone command(s)"`

Per user decision (LOCKED): standalone commands can overwrite each other freely. Only GSD commands directory is protected. Since standalone commands are flat `.md` files copied to `~/.claude/commands/` and GSD lives in `~/.claude/commands/gsd/` (a subdirectory), there's no conflict unless a plugin tries to write a `gsd/` directory — which is handled in Plan 02.

**4. Update summary section (~line 411-423):**

Update the summary block at the end of the script to include the commands count:
- Add `echo "[install] Commands: $COMMANDS_COUNT standalone command(s)"` line after the Skills line
- Update the Skills line to show `"Skills: $SKILLS_COUNT skill(s) -> Claude + Codex"` pattern

Note: The `COMMANDS_COUNT` variable must be initialized before the summary section. It should be initialized alongside the other counters near line 30-36.
  </action>
  <verify>
Run: `bash -n .devcontainer/install-agent-config.sh` to verify no syntax errors.
Grep for "COMMANDS_COUNT" to confirm counter is initialized and used.
Grep for "codex/skills" to confirm cross-agent copy exists.
Grep for "skills = true" to confirm Codex feature flag.
Grep for "agent-config/commands" to confirm standalone commands section exists.
  </verify>
  <done>
- Standalone commands section copies `agent-config/commands/*.md` to `~/.claude/commands/` with counter and GSD-safe behavior
- Skills are copied to both `~/.claude/skills/` and `~/.codex/skills/`
- Codex `config.toml` generation includes `[features] skills = true`
- Install summary includes commands count and updated skills line
- Script passes bash syntax check (`bash -n`)
  </done>
</task>

</tasks>

<verification>
1. `bash -n .devcontainer/install-agent-config.sh` passes (no syntax errors)
2. `grep -c "COMMANDS_COUNT" .devcontainer/install-agent-config.sh` returns 3+ (init, increment, summary)
3. `grep "codex/skills" .devcontainer/install-agent-config.sh` shows copy to Codex skills directory
4. `grep "skills = true" .devcontainer/install-agent-config.sh` shows Codex feature flag
5. `grep "agent-config/commands" .devcontainer/install-agent-config.sh` shows standalone commands section
</verification>

<success_criteria>
- CMD-01: Standalone commands copied from agent-config/commands/ to ~/.claude/commands/
- CMD-02: GSD commands directory protected (standalone .md files don't conflict with gsd/ subdirectory)
- CMD-03: Command count reported in install summary
- Cross-agent skills: Skills copied to both Claude and Codex directories
- Codex discovery: config.toml includes [features] skills = true
- Install feedback: Skills line reflects dual destination
</success_criteria>

<output>
After completion, create `.planning/phases/04-core-plugin-system/04-01-SUMMARY.md`
</output>
