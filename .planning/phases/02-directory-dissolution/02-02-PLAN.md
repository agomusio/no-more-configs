---
phase: 02-directory-dissolution
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - .devcontainer/mcp-setup-bin.sh
  - .devcontainer/setup-network-checks.sh
  - README.md
  - docs/codex-refactor-prompt.md
  - docs/codex-setup.sh
  - docs/archive/2026-02-11/codex-langfuse-hook-robustness.md
  - docs/archive/2026-02-11/codex-compose-hardening-audit.md
  - docs/archive/2026-02-10/codex-mcp-integration-spec.md
autonomous: true

must_haves:
  truths:
    - "mcp-setup-bin.sh references infra/ not langfuse-local/ and uses LANGFUSE_STACK_DIR env var"
    - "setup-network-checks.sh references infra/ not langfuse-local/ and uses LANGFUSE_STACK_DIR env var"
    - "README.md references infra/ not claudehome/langfuse-local/ and documents new directory structure"
    - "No file outside claudehome/ contains a reference to claudehome/ or langfuse-local/"
    - "claudehome/ directory no longer exists in the repo"
  artifacts:
    - path: ".devcontainer/mcp-setup-bin.sh"
      provides: "MCP setup script with updated paths"
      contains: "LANGFUSE_STACK_DIR"
    - path: ".devcontainer/setup-network-checks.sh"
      provides: "Network check script with updated paths"
      contains: "LANGFUSE_STACK_DIR"
    - path: "README.md"
      provides: "Updated documentation with new directory structure"
      contains: "infra/"
  key_links:
    - from: ".devcontainer/mcp-setup-bin.sh"
      to: "infra/"
      via: "LANGFUSE_STACK_DIR environment variable"
      pattern: "LANGFUSE_STACK_DIR"
    - from: ".devcontainer/setup-network-checks.sh"
      to: "infra/"
      via: "LANGFUSE_STACK_DIR environment variable"
      pattern: "LANGFUSE_STACK_DIR"
    - from: "README.md"
      to: "infra/"
      via: "Documentation path references"
      pattern: "infra/"
---

<objective>
Update all path references in scripts and documentation to use the new directory locations (infra/ instead of langfuse-local/, no claudehome/ prefix), then delete the claudehome/ directory.

Purpose: This is the WIRE + DELETE step of the add-wire-delete migration pattern. All references are rewired to new paths using environment variables, then the old claudehome/ directory is removed. After this plan, the dissolution is complete.

Output: All scripts and docs reference infra/ and use LANGFUSE_STACK_DIR env var. claudehome/ directory deleted from repo. Zero references to old paths remain.
</objective>

<execution_context>
@/home/node/.claude/get-shit-done/workflows/execute-plan.md
@/home/node/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-directory-dissolution/02-RESEARCH.md
@.planning/phases/02-directory-dissolution/02-01-SUMMARY.md
@.devcontainer/mcp-setup-bin.sh
@.devcontainer/setup-network-checks.sh
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update path references in .devcontainer/ scripts</name>
  <files>
    .devcontainer/mcp-setup-bin.sh
    .devcontainer/setup-network-checks.sh
  </files>
  <action>
    Update .devcontainer/mcp-setup-bin.sh:
    - Line 30: Change `cd /workspace/claudehome/langfuse-local && docker compose up -d docker-mcp-gateway`
      to `cd ${LANGFUSE_STACK_DIR:-/workspace/infra} && docker compose up -d docker-mcp-gateway`
    - Line 37: Change `Edit langfuse-local/mcp/mcp.json`
      to `Edit ${LANGFUSE_STACK_DIR:-/workspace/infra}/mcp/mcp.json`
    - Use ${LANGFUSE_STACK_DIR:-/workspace/infra} pattern (with fallback) since this script runs in sh, not bash

    Update .devcontainer/setup-network-checks.sh:
    - Line 17: Change `cd /workspace/claudehome/langfuse-local && sudo docker compose up -d`
      to `cd ${LANGFUSE_STACK_DIR:-/workspace/infra} && sudo docker compose up -d`

    Commit message: "refactor(02-02): update devcontainer scripts to use LANGFUSE_STACK_DIR"
  </action>
  <verify>
    grep "claudehome" .devcontainer/mcp-setup-bin.sh (should return NO matches)
    grep "langfuse-local" .devcontainer/mcp-setup-bin.sh (should return NO matches)
    grep "LANGFUSE_STACK_DIR" .devcontainer/mcp-setup-bin.sh (should find matches)
    grep "claudehome" .devcontainer/setup-network-checks.sh (should return NO matches)
    grep "LANGFUSE_STACK_DIR" .devcontainer/setup-network-checks.sh (should find matches)
  </verify>
  <done>Both .devcontainer/ scripts reference infra/ via LANGFUSE_STACK_DIR environment variable. Zero references to claudehome/ or langfuse-local/ remain in .devcontainer/ scripts.</done>
</task>

<task type="auto">
  <name>Task 2: Update README.md and docs/ path references</name>
  <files>
    README.md
    docs/codex-refactor-prompt.md
    docs/codex-setup.sh
    docs/archive/2026-02-11/codex-langfuse-hook-robustness.md
    docs/archive/2026-02-11/codex-compose-hardening-audit.md
    docs/archive/2026-02-10/codex-mcp-integration-spec.md
  </files>
  <action>
    Update README.md comprehensively. This is the primary documentation file and has many path references:

    Replace all occurrences of these patterns:
    - `/workspace/claudehome/langfuse-local` -> `/workspace/infra` (or `${LANGFUSE_STACK_DIR}` in command examples)
    - `/workspace/claudehome/.claude/skills/` -> `agent-config/skills/` (source) or `~/.claude/skills/` (runtime)
    - `/workspace/claudehome/.claude/settings.local.json` -> generated by install-agent-config.sh
    - `/workspace/claudehome/.planning/` -> `/workspace/.planning/`
    - `/workspace/claudehome/scripts/` -> `infra/scripts/`
    - `/workspace/claudehome/` -> `/workspace/` (for general workspace references)
    - `claudehome/langfuse-local/` -> `infra/` (in relative paths and links)
    - `langfuse-local/` -> `infra/` (standalone references to the infra directory)
    - `cd /workspace/claudehome && claude` -> `claude` (in alias descriptions)

    Specific README sections requiring updates:
    - "Shell Shortcuts" table: Update alias descriptions to remove cd prefix
    - "Quick Start" section 2: Change `cd /workspace/claudehome/langfuse-local` to `cd /workspace/infra`
    - "Configure Claude Code Tracing" section: Update reference from `claudehome/langfuse-local/settings-examples/` to `infra/settings-examples/`
    - "Custom Skills" section: Update skill paths
    - "MCP Gateway" section: Update `langfuse-local/mcp/mcp.json` to `infra/mcp/mcp.json`
    - "Adding a Server" example: Update cd and path references
    - "Key Paths" table: Complete overhaul -- remove claudehome entries, add infra/ entries, add agent-config/ entries
    - "Troubleshooting" section: Update path references for API key matching
    - "Maintenance" section: Update langfuse stack commands to use infra/
    - "Project Structure" tree: Complete overhaul -- remove claudehome/, add infra/ and agent-config/

    For the "Project Structure" tree, the new structure should reflect:
    ```
    /workspace/
    ├── .devcontainer/       # (unchanged contents)
    ├── .planning/           # GSD project planning (phases, research, state)
    ├── .vscode/             # (unchanged)
    ├── agent-config/        # Version-controlled agent config source
    │   ├── mcp-templates/   # MCP server templates
    │   ├── settings.json.template  # Claude Code settings template
    │   └── skills/          # Custom skills (devcontainer, gitprojects)
    ├── config.json          # Master non-secret settings
    ├── infra/               # Langfuse + MCP gateway infrastructure
    │   ├── docker-compose.yml
    │   ├── .env             # Generated credentials (git-ignored)
    │   ├── mcp/             # MCP gateway configuration
    │   ├── hooks/           # Langfuse hooks
    │   ├── scripts/         # generate-env.sh, validate-setup.sh, verify-*.sh
    │   ├── settings-examples/
    │   └── tests/
    ├── gitprojects/         # Working directory for repos
    └── docs/                # Documentation
    ```

    Update docs/ files:
    - These are historical documents (codex prompts, audit reports). Update path references where they appear but do not restructure the documents themselves.
    - Replace `claudehome/langfuse-local` with `infra` and `claudehome/` with appropriate new paths.
    - For docs/codex-setup.sh: update any cd or path commands referencing old structure.

    Commit message: "docs(02-02): update README and docs to reflect new directory structure"
  </action>
  <verify>
    grep -r "claudehome" README.md (should return NO matches)
    grep -r "langfuse-local" README.md (should return NO matches)
    grep -r "claudehome" docs/ --include="*.md" --include="*.sh" (should return NO matches)
    grep "infra/" README.md (should find multiple matches)
    grep "agent-config/" README.md (should find matches)
  </verify>
  <done>README.md and all docs/ files reference infra/ instead of claudehome/langfuse-local/. Project Structure tree reflects the new directory layout. Zero references to claudehome/ or langfuse-local/ remain in any documentation file.</done>
</task>

<task type="auto">
  <name>Task 3: Delete claudehome/ directory</name>
  <files>
    claudehome/ (entire directory tree -- DELETE)
  </files>
  <action>
    Final verification before deletion -- run grep to confirm no remaining references:
    ```bash
    grep -r "claudehome" .devcontainer/ README.md docs/ .planning/ROADMAP.md .planning/STATE.md .planning/PROJECT.md --include="*.sh" --include="*.json" --include="*.yml" --include="*.md" 2>/dev/null
    ```
    Note: .planning/ files (ROADMAP.md, STATE.md, PROJECT.md, REQUIREMENTS.md) will still contain "claudehome" in their requirement descriptions and historical context. That is acceptable -- these are planning documents describing the refactor itself, not operational config.

    Delete the entire claudehome/ directory:
    ```bash
    git rm -rf claudehome/
    ```

    This removes:
    - claudehome/.claude/settings.local.json (DIR-07 -- replaced by install-agent-config.sh)
    - claudehome/.claude/skills/aa-cloudflare/ (vendor skill, reinstalls independently)
    - claudehome/.claude/skills/aa-fullstack/ (vendor skill, reinstalls independently)
    - claudehome/.claude/skills/devcontainer/ (already copied to agent-config/skills/ in Plan 01)
    - claudehome/.claude/skills/gitprojects/ (already copied to agent-config/skills/ in Plan 01)
    - claudehome/.claude/commands/ (GSD commands reinstall from npm)
    - claudehome/.planning/ (DIR-03 -- OLD/stale planning from different project scope, workspace .planning/ is current)
    - claudehome/scripts/ (already moved to infra/scripts/ in Plan 01)
    - claudehome/langfuse-local/ (already moved to infra/ in Plan 01 -- should already be gone from git mv)
    - Any remaining empty directories

    IMPORTANT: claudehome/langfuse-local/ was moved with git mv in Plan 01, so it should already be tracked as a rename. The git rm -rf claudehome/ will clean up everything that remains.

    Commit message: "refactor(02-02): remove claudehome directory (DIR-08)"
  </action>
  <verify>
    Verify claudehome/ no longer exists:
    - ls claudehome/ (should fail with "No such file or directory")
    - git status (should show deleted files, no untracked files)

    Verify nothing was lost -- all redistributed files exist:
    - ls agent-config/skills/devcontainer/SKILL.md
    - ls agent-config/skills/gitprojects/SKILL.md
    - ls infra/docker-compose.yml
    - ls infra/scripts/verify-filesystem-mcp.sh

    Run comprehensive reference check:
    - grep -r "claudehome" .devcontainer/ README.md docs/ --include="*.sh" --include="*.json" --include="*.yml" --include="*.md" (should return NO matches in operational files)
  </verify>
  <done>claudehome/ directory is completely removed from the repository. All contents have been redistributed: custom skills in agent-config/skills/, infrastructure in infra/, verification scripts in infra/scripts/. Stale planning directory and replaced settings.local.json are deleted. DIR-01 through DIR-08 requirements are satisfied.</done>
</task>

</tasks>

<verification>
Phase-level checks for Plan 02 (and overall Phase 2 completion):

Requirements verification:
- DIR-01: claudehome/ dissolved -- `ls claudehome/` fails
- DIR-02: Skills in agent-config/skills/ -- `ls agent-config/skills/devcontainer/SKILL.md`
- DIR-03: Planning state at /workspace/.planning/ (already done) -- `ls .planning/PROJECT.md`
- DIR-04: Infrastructure at infra/ -- `ls infra/docker-compose.yml`
- DIR-05: Verification scripts at infra/scripts/ -- `ls infra/scripts/verify-filesystem-mcp.sh`
- DIR-06: All path references updated -- `grep -r "claudehome" .devcontainer/ README.md docs/` returns nothing
- DIR-07: settings.local.json deleted -- `ls claudehome/.claude/settings.local.json` fails
- DIR-08: claudehome/ removed -- `ls claudehome/` fails
- CTR-02: Aliases updated -- `grep "claudey" .devcontainer/Dockerfile` shows no cd prefix
- CTR-03: Sessions can launch from any directory -- aliases use bare `claude` command
- CTR-04: GSD finds .planning/ -- .planning/ exists at workspace root, aliases don't force working directory

Comprehensive path reference check:
```bash
grep -r "claudehome\|langfuse-local" .devcontainer/ README.md docs/ --include="*.sh" --include="*.json" --include="*.yml" --include="*.md"
```
Expected: Zero matches in operational files. Planning documents (.planning/) may contain historical references.
</verification>

<success_criteria>
- All .devcontainer/ scripts use LANGFUSE_STACK_DIR instead of hardcoded langfuse-local/ paths
- README.md accurately describes new directory structure with infra/ and agent-config/
- claudehome/ directory no longer exists in the repository
- No operational file references claudehome/ or langfuse-local/
- All 11 Phase 2 requirements (DIR-01 through DIR-08, CTR-02 through CTR-04) are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/02-directory-dissolution/02-02-SUMMARY.md`
</output>
